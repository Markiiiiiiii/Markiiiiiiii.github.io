{"meta":{"title":"老菜的菜单","subtitle":"记录点技术点滴","description":"","author":"Liuuuuuuuuu","url":"http://markiiiiiiii.github.io","root":"/"},"pages":[{"title":"分类","date":"2020-08-03T03:52:25.000Z","updated":"2020-08-03T03:56:00.368Z","comments":true,"path":"categories/index.html","permalink":"http://markiiiiiiii.github.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2020-08-03T03:56:56.000Z","updated":"2020-08-03T03:57:14.411Z","comments":true,"path":"tags/index.html","permalink":"http://markiiiiiiii.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"rsync+inofity内网向外网同步数据","slug":"rsync-inofity内网向外网同步数据","date":"2020-08-03T03:22:53.000Z","updated":"2020-08-03T03:58:27.557Z","comments":true,"path":"2020/08/03/rsync-inofity内网向外网同步数据/","link":"","permalink":"http://markiiiiiiii.github.io/2020/08/03/rsync-inofity%E5%86%85%E7%BD%91%E5%90%91%E5%A4%96%E7%BD%91%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE/","excerpt":"","text":"设计要求 内网web服务器生成html页面 内网向外网同步生成的html页面和目录 外网服务器纯静态资源访问 系统环境 内网 Ubuntu 20.x + Ngnix + PHP + Mysql + Wordpress 外网 Ubuntu 20.x + Ngnix 外网服务器配置外网服务器必须提供rsync –daemon服务以监听内网服务器发出的同步指令 12345678910111213141516171819202122232425[123] comment &#x3D; 123 static html files server path &#x3D; &#x2F;var&#x2F;www&#x2F;staichtml&#x2F; use chroot &#x3D; no max connections&#x3D;20 lock file &#x3D; &#x2F;var&#x2F;lock&#x2F;rsyncd read only &#x3D; no write only &#x3D; no list &#x3D; yes uid &#x3D; rsync gid &#x3D; rsync auth users &#x3D; rsync_clint secrets file &#x3D; &#x2F;etc&#x2F;rsyncd.secrets strict modes &#x3D; yes port&#x3D;873 pid file &#x3D; &#x2F;var&#x2F;run&#x2F;rsyncd.pid log file &#x3D; &#x2F;var&#x2F;log&#x2F;rsyncd.log log format &#x3D; %t %a %m %f %b ignore errors &#x3D; yes ignore nonreadable &#x3D; yes transfer logging &#x3D; yes timeout &#x3D; 600 refuse options &#x3D; checksum dry-run dont compress &#x3D; *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz 创建 /etc/rsyncd.secrets 并 chmod 600 权限 1rsync_clint:密码123 添加一个系统用户为rsync的用户 该用户不具备登录权限 &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;useradd -s &amp;#x2F;sbin&amp;#x2F;nologin -M rsync&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt; ！！！注意！！！必须 chmod 777 /var/www/staichtml/ 在实际操作中发现没有x权限rsync服务无法写入文件 内网服务器配置略过相关web服务配置创建 /etc/rsyncd.secrets 并 chmod 600 权限，仅存放密码使用 1密码123 安装apt install inofity-tool 编写简单实现的.sh文件并 chmod +x xxxx.sh 12345678910#!&#x2F;bin&#x2F;bashsrc&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;mystaticsite&#x2F; #同步目录路径ip&#x3D;111.111.111.111&#x2F;usr&#x2F;bin&#x2F;inotifywait -rm --timefmt &#39;%d&#x2F;%m&#x2F;%y %H:%M&#39; --format &#39;%T %w%f%e&#39; -e modify,delete,create,attrib,move $src | while read file do rsync -avz --delete --progress $src rsync_clint@$ip::123 --password-file&#x3D;&#x2F;etc&#x2F;rsyncd.secrets echo &quot;$&#123;file&#125; was rsynced&quot; &gt;&gt; &#x2F;tmp&#x2F;rsync.log 2&gt;&amp;1 done 123！！！注意！！！必须将$src的位置写在连接之前不能放在连接之后，不然外网服务器无法接受到文件。这一点与网上很多教程向左，卡了我两天多的时间才发现的:(","categories":[{"name":"运维","slug":"运维","permalink":"http://markiiiiiiii.github.io/categories/%E8%BF%90%E7%BB%B4/"}],"tags":[{"name":"Ubuntu","slug":"Ubuntu","permalink":"http://markiiiiiiii.github.io/tags/Ubuntu/"},{"name":"rsync","slug":"rsync","permalink":"http://markiiiiiiii.github.io/tags/rsync/"},{"name":"inotify","slug":"inotify","permalink":"http://markiiiiiiii.github.io/tags/inotify/"}]},{"title":"rsync同步基本配置（基础知识）","slug":"rsync同步基本配置（基础知识）","date":"2020-08-03T02:04:38.000Z","updated":"2020-08-03T03:58:21.709Z","comments":true,"path":"2020/08/03/rsync同步基本配置（基础知识）/","link":"","permalink":"http://markiiiiiiii.github.io/2020/08/03/rsync%E5%90%8C%E6%AD%A5%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%EF%BC%88%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%89/","excerpt":"","text":"rrsync同步基本配置（基础知识）Ubuntu 20.x 环境服务器端：1234567891011121314151617181920[123] comment &#x3D; 123 static html files serverpath &#x3D; &#x2F;var&#x2F;www&#x2F;html&#x2F;siteuse chroot &#x3D; nomax connections&#x3D;20lock file &#x3D; &#x2F;var&#x2F;lock&#x2F;rsyncdread only &#x3D; yeslist &#x3D; yesuid &#x3D; 0gid &#x3D; 0 auth users &#x3D; 123clint secrets file &#x3D; &#x2F;etc&#x2F;rsyncd.secrets strict modes &#x3D; yes port&#x3D;873ignore errors &#x3D; yesignore nonreadable &#x3D; yestransfer logging &#x3D; yestimeout &#x3D; 600refuse options &#x3D; checksum dry-rundont compress &#x3D; *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz 增加/etc/rsyncd.secrets文件 1123clint：密码123456 启动服务器： 1&#x2F;etc&#x2F;init.d&#x2F;rsync --daemon 客户端：增加/etc/rsyncd.secrets文件 1密码123456 客户端连接服务器命令 1rsync -vzrtopg --delete --progress 123clint@服务器地址::123 &#x2F;var&#x2F;www&#x2F;staichtml（客户端备份目录位置） --password-file&#x3D;&#x2F;etc&#x2F;rsyncd.secrets 注意客户端和服务器端的rsyncd.secrets 文件均需要chmod 600 权限 1chmod 600 rsyncd.secrets","categories":[{"name":"运维","slug":"运维","permalink":"http://markiiiiiiii.github.io/categories/%E8%BF%90%E7%BB%B4/"}],"tags":[{"name":"Ubuntu","slug":"Ubuntu","permalink":"http://markiiiiiiii.github.io/tags/Ubuntu/"},{"name":"rsync","slug":"rsync","permalink":"http://markiiiiiiii.github.io/tags/rsync/"}]}],"categories":[{"name":"运维","slug":"运维","permalink":"http://markiiiiiiii.github.io/categories/%E8%BF%90%E7%BB%B4/"}],"tags":[{"name":"Ubuntu","slug":"Ubuntu","permalink":"http://markiiiiiiii.github.io/tags/Ubuntu/"},{"name":"rsync","slug":"rsync","permalink":"http://markiiiiiiii.github.io/tags/rsync/"},{"name":"inotify","slug":"inotify","permalink":"http://markiiiiiiii.github.io/tags/inotify/"}]}